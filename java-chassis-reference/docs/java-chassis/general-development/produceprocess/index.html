<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Return value serialization extension - ServiceComb Java Chassis 开发指南</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Return value serialization extension";
    var mkdocs_page_input_path = "general-development\\produceprocess.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> ServiceComb Java Chassis 开发指南</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">Getting Started</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../start/terminology/">Glossary</a>
                </li>
                <li class="">
                    
    <a class="" href="../../start/architecture/">Architecture</a>
                </li>
                <li class="">
                    
    <a class="" href="../../start/development-environment/">Development environment</a>
                </li>
                <li class="">
                    
    <a class="" href="../../start/first-sample/">Develop the first microservice</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development Service Provider</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../build-provider/definition/service-definition/">Service definition</a>
                </li>
                <li class="">
                    
    <a class="" href="../../build-provider/define-contract/">Service contract definition</a>
                </li>
                <li class="">
                    
    <a class="" href="../../build-provider/code-first/">Implicit API definition</a>
                </li>
                <li class="">
                    
    <a class="" href="../../build-provider/swagger-annotation/">Use Swagger annotations</a>
                </li>
                <li class="">
                    
    <a class="" href="../../build-provider/springmvc/">Develop with SpringMVC</a>
                </li>
                <li class="">
                    
    <a class="" href="../../build-provider/jaxrs/">Develop with JAX-RS</a>
                </li>
                <li class="">
                    
    <a class="" href="../../build-provider/transparent-rpc/">Develop with Transparent RPC</a>
                </li>
                <li class="">
                    
    <a class="" href="../../build-provider/interface-constraints/">Interface definition and data type</a>
                </li>
                <li class="">
                    
    <a class="" href="../../build-provider/listen-address-and-publish-address/">Service listening address and publishing address</a>
                </li>
                <li class="">
                    
    <a class="" href="../../build-provider/thread-pool/">Thread pool</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Service Configuration</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../build-provider/configuration/lb-strategy/">Load Balancing Policy</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../build-provider/configuration/ratelimite-strategy/">Rate Limiting Policy</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../build-provider/configuration/downgrade-strategy/">Fallback Policy</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../build-provider/configuration/parameter-validator/">Parameter Validator</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../build-provider/bootup/">Boot-up Process</a>
                </li>
                <li class="">
                    
    <a class="" href="../../build-provider/access-log-configuration/">Access Log Configuration</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Writing Service Consumer</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../build-consumer/common-configuration/">Consumer common configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../build-consumer/using-resttemplate/">Using Rest Template</a>
                </li>
                <li class="">
                    
    <a class="" href="../../build-consumer/using-AsyncRestTemplate/">Using AsynRestTemplate</a>
                </li>
                <li class="">
                    
    <a class="" href="../../build-consumer/develop-consumer-using-rpc/">Using with RPC</a>
                </li>
                <li class="">
                    
    <a class="" href="../../build-consumer/with-contract/">Contract</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Invoke control</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../build-consumer/circuit-breaker/">Circuit Breaker</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../build-consumer/flow-control/">Flow Control</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../build-consumer/fault-injection/">Fault Injection</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../build-consumer/3rd-party-service-invoke/">Invoke 3rd-party REST services</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Transports</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../transports/rest-over-servlet/">REST over Servlet</a>
                </li>
                <li class="">
                    
    <a class="" href="../../transports/rest-over-vertx/">REST over Vertx</a>
                </li>
                <li class="">
                    
    <a class="" href="../../transports/highway-rpc/">Highway</a>
                </li>
                <li class="">
                    
    <a class="" href="../../transports/http2/">HTTP2</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">General Development</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../visit-sc/">Access Service Center</a>
                </li>
                <li class="">
                    
    <a class="" href="../metrics/">Metrics</a>
                </li>
                <li class="">
                    
    <a class="" href="../microservice-invocation-chain/">Microservice invocation chain</a>
                </li>
                <li class="">
                    
    <a class="" href="../customized-tracing/">Customized-Tracing</a>
                </li>
                <li class="">
                    
    <a class="" href="../local-develop-test/">Local development and testing</a>
                </li>
                <li class="">
                    
    <a class="" href="../http-filter/">Http Filter</a>
                </li>
                <li class="">
                    
    <a class="" href="../file-upload/">File Uploading</a>
                </li>
                <li class="">
                    
    <a class="" href="../file-download/">File Downloading</a>
                </li>
                <li class="">
                    
    <a class="" href="../reactive/">Reactive Programing</a>
                </li>
                <li class="">
                    
    <a class="" href="../dnsconfig/">DNS Custom Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../dai-li-she-zhi/">Proxy Settings</a>
                </li>
                <li class="">
                    
    <a class="" href="../report-framework-version/">Report framework version</a>
                </li>
                <li class="">
                    
    <a class="" href="../cross-app-invocation/">Cross-application invocation</a>
                </li>
                <li class="">
                    
    <a class="" href="../secret-field/">Customized serialization and deserialization</a>
                </li>
                <li class="">
                    
    <a class="" href="../context/">Using Context to pass control messages</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Return value serialization extension</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#return-value-serialization-extension">return value serialization extension</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#concept-description">Concept Description</a></li>
        
            <li><a class="toctree-l4" href="#development-instructions">Development Instructions</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../CORS/">CORS mechanism</a>
                </li>
                <li class="">
                    
    <a class="" href="../AlarmEvent/">Get fuse and instance isolation alarm event information</a>
                </li>
                <li class="">
                    
    <a class="" href="../shutdown/">Shutdown gracefully</a>
                </li>
                <li class="">
                    
    <a class="" href="../error-handling/">Handling exceptions</a>
                </li>
                <li class="">
                    
    <a class="" href="../multienvironment/">Multi-environment isolation between microservice instances</a>
                </li>
                <li class="">
                    
    <a class="" href="../thread-model/">Thread Model</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Configuration</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../config/general-config/">General config</a>
                </li>
                <li class="">
                    
    <a class="" href="../../config/inject-config/">Configuration injection</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Service Capability Open</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../edge/by-servicecomb-sdk/">Using Edge Service</a>
                </li>
                <li class="">
                    
    <a class="" href="../../edge/nginx/">Using confd and Nginx as edge services</a>
                </li>
                <li class="">
                    
    <a class="" href="../../edge/zuul/">Use zuul as edge services</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Service Packing and Running</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../packaging/standalone/">Standalone mode</a>
                </li>
                <li class="">
                    
    <a class="" href="../../packaging/web-container/">WEB container mode</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Micro Service Security</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../security/tls/">Using TLS</a>
                </li>
                <li class="">
                    
    <a class="" href="../../security/rsa/">Using RSA certification</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Using java chassis in Spring Boot</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../using-java-chassis-in-spring-boot/components-for-spring-boot/">spring boot starter for java-chassis</a>
                </li>
                <li class="">
                    
    <a class="" href="../../using-java-chassis-in-spring-boot/java-application/">JAVA application development</a>
                </li>
                <li class="">
                    
    <a class="" href="../../using-java-chassis-in-spring-boot/web-application/">Web development method development</a>
                </li>
                <li class="">
                    
    <a class="" href="../../using-java-chassis-in-spring-boot/diff-between-java-web/">The difference between JAVA application method and Web development method</a>
                </li>
                <li class="">
                    
    <a class="" href="../../using-java-chassis-in-spring-boot/diff-spring-mvc/">The difference in Spring MVC mode</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Handlers reference</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../references-handlers/loadbalance/">Load Balancing</a>
                </li>
                <li class="">
                    
    <a class="" href="../../references-handlers/publickey/">Public key authentication</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">FAQ</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../question-and-answer/interface-compatibility/">Micro Service Interface Compatibility FAQ</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">ServiceComb Java Chassis 开发指南</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>General Development &raquo;</li>
        
      
    
    <li>Return value serialization extension</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="return-value-serialization-extension">return value serialization extension</h1>
<h2 id="concept-description">Concept Description</h2>
<p>The current REST channel return value supports both application/json and text/plain formats, supports developer extensions and rewrites, service providers provide serialization capabilities through producer declarations, and service consumers specify return value serialization through the request's Accept header. By default, the data in application/json format is returned.</p>
<h2 id="development-instructions">Development Instructions</h2>
<ul>
<li>
<h3 id="extension">extension</h3>
</li>
</ul>
<p>Developers can extend the return value serialization method programmatically based on business needs. The implementation steps are as follows, taking the extended support application/xml format as an example:</p>
<p>1. Implement the interface <code>ProduceProcessor</code>.</p>
<p>&gt; getName() returns the current extended data type name
  &gt;
  &gt; getOrder() returns the current data type priority. It has multiple implementation classes with the same name. It only loads the highest priority. The smaller the number, the higher the priority.
  &gt;
  &gt; doEncodeResponse(OutputStream output, Object result) encodes the result object into output, where the logic needs to be implemented by itself.
  &gt;
  &gt; doDecodeResponse(InputStream input, JavaType type) parses the input into the corresponding object, where the logic needs to be implemented by itself.</p>
<p>```java
  public class ProduceAppXmlProcessor implements ProduceProcessor {</p>
<pre><code>@Override
public String getName() {
  return MediaType.APPLICATION_XML;
}

@Override
public int getOrder() {
  return 0;
}

@Override
public void doEncodeResponse(OutputStream output, Object result) throws Exception {
  output.write(JAXBUtils.convertToXml(result).getBytes());
}

@Override
public Object doDecodeResponse(InputStream input, JavaType type) throws Exception {
  return JAXBUtils.convertToJavaBean(input, type);
}
</code></pre>
<p>}
  ```</p>
<p>2. Add a configuration file</p>
<p>In the META-INF/services/ folder under resources, create a new file xxx.ProduceProcessor (xxx is the package name of the interface), and fill in the content xxx.ProduceAppXmlProcessor (xxx is the package name of the implementation class).</p>
<ul>
<li>
<h3 id="rewrite">Rewrite</h3>
</li>
</ul>
<p>Developers can rewrite the existing application/json and text/plain implementation logic, or rewrite the self-extended format to rewrite the xml serialization method as an example:</p>
<p>1. Create a class named 'ProduceAppXmlProcessor<code>with the same name to implement the interface</code>ProduceProcessor`.</p>
<p>2. Rewrite the codec logic in the <code>doEncodeResponse</code> and <code>doDecodeResponse</code> methods</p>
<p>3. Change the return value in the getOrder method, which is smaller than the return value of the original method. For example, return -1, the original method return value of application/json and text/plain defaults to 0.</p>
<p>4. In the META-INF/services/ folder under resources, create a new file xxx.ProduceProcessor (xxx is the package name of the interface), and fill in the content xxx.ProduceAppXmlProcessor (xxx is the package name of the implementation class).</p>
<ul>
<li>
<h3 id="verification">verification</h3>
</li>
</ul>
<p>Service providers provide xml serialization capabilities through producer declarations</p>
<p><code>java
    @RequestMapping(path = "/appXml", method = RequestMethod.POST, produces = MediaType.APPLICATION_XML_VALUE)
    public JAXBPerson appXml(@RequestBody JAXBPerson person) {
      return person;
    }</code></p>
<p>The service consumer indicates the return value xml serialization mode through the request's Accept header.</p>
<p><code>java
    private void testCodeFirstAppXml(RestTemplate template, String cseUrlPrefix) {
      JAXBPerson person = new JAXBPerson("jake", 22, "it", "60kg");
      person.setJob(new JAXBJob("developer", "coding"));
      HttpHeaders headers = new HttpHeaders();
      headers.add("Accept", MediaType.APPLICATION_XML_VALUE);
      HttpEntity&lt;JAXBPerson&gt; requestEntity = new HttpEntity&lt;&gt;(person, headers);
      ResponseEntity&lt;JAXBPerson&gt; resEntity = template.exchange(cseUrlPrefix + "appXml",
          HttpMethod.POST,
          requestEntity,
          JAXBPerson.class);
      TestMgr.check(person, resEntity.getBody());
    }</code></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../CORS/" class="btn btn-neutral float-right" title="CORS mechanism">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../context/" class="btn btn-neutral" title="Using Context to pass control messages"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../context/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../CORS/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
